---

# üì¶ NEIRA

### –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
‚îú‚îÄ‚îÄ /app                              # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ /flows/                       
‚îÇ       ‚îú‚îÄ‚îÄ /data_processing_deploy/  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ /read_csv_deploy/         # –ß—Ç–µ–Ω–∏–µ CSV —Ñ–∞–π–ª–∞
‚îÇ       ‚îú‚îÄ‚îÄ /send_request_deploy/     # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ docker-compose.yaml       # Prefect server
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt              # –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ /envs                             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –±–æ—Ç–∞ –∏ RabbitMQ
‚îú‚îÄ‚îÄ /rabbitmq                         # RabbitMQ
‚îú‚îÄ‚îÄ /telegram_bot                     # –¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ start_docker_compose_files.sh     # –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ text.txt                          # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ prefect
```

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker compose -f rabbitmq/docker-compose.yaml --env-file rabbitmq/.env --env-file envs/.env.rabbitmq_login_data up -d

docker compose -f telegram_bot/docker-compose.yaml --env-file telegram_bot/.env --env-file envs/.env.rabbitmq_login_data up -d

docker compose -f app/docker-compose.yaml --env-file envs/.env.prefect_server --env-file envs/.env.rabbitmq_login_data up -d
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
pip isntall -r .\app\requirements.txt
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ work pool:

concurrency-limit 1 —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π worker –≤—ã–ø–æ–ª–Ω—è–ª —Ç–æ–ª—å–∫–æ –ø–æ –æ–¥–Ω–æ–º—É flow\task

```bash
prefect work-pool create --type docker sobes_workers
prefect work-pool update sobes_workers --concurrency-limit 1
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ work queues:

limit 1 —á—Ç–æ–±—ã –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –±—Ä–∞–ª–æ—Å—å –ø–æ 1 flow\
–¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª-–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

```bash
prefect work-queue create read_csv_queue -p sobes_workers
prefect work-queue create send_request_queue -p sobes_workers --limit 1
prefect work-queue create data_processing_queue -p sobes_workers 
```

### 5. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 1 task –≤ 30 —Å–µ–∫—É–Ω–¥ 

```bash
prefect gcl create my_timeout --limit 1 --slot-decay-per-second 0.033
```
### 6. Deployments:

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã main.py –≤ app/flows —á—Ç–æ–±—ã –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤ prefect


## üß™ –ó–∞–ø—É—Å–∫

–ü–æ—Å—Ç–∞–≤–∏–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 20 —Å—Ç—Ä–æ–∫ –∏–∑ –≤—Å–µ–≥–æ CSV —Ñ–∞–π–ª–∞ \
—ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–º –Ω—É–∂–Ω—ã worker \
—è –∑–∞–ø—É—Å–∫–∞—é 3 —Ç–µ—Ä–º–∏–Ω–∞–ª

1 —Ç–µ—Ä–º–∏–Ω–∞–ª –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏

```bash
prefect worker start --pool "sobes_workers"
```

1 —Ç–µ—Ä–º–∏–Ω–∞–ª –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ API

```bash
prefect worker start --pool "sobes_workers" --work-queue "send_request_queue"
```

1 —Ç–µ—Ä–º–∏–Ω–∞–ª –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

```bash
prefect worker start --pool "sobes_workers" --work-queue "data_processing_queue"
```

## üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–∫ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ, —Ç–æ —è —Ä–µ—à–∏–ª –∑–∞–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ \
–æ—á–µ—Ä–µ–¥—å, —á—Ç–æ–±—ã worker–´ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –±—Ä–∞–ª–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ API \
—Ç—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –Ω–µ –±–æ–ª—å—â–µ 1 –∑–∞–¥–∞—á–∏ \
–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö \
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª my_timeout —á—Ç–æ–±—ã –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–æ 30 —Å–µ–∫ \
–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ work pool –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç worker–ê –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ 1 –∑–∞–¥–∞—á–µ \
—Ç—É—Ç –≤–æ–∑–Ω–∏–∫–ª–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Ç–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –¥–æ —ç—Ç–æ–≥–æ —Å prefect \
–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å network –∏ volume \
–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç task\flow \
–ø–æ—ç—Ç–æ–º—É –Ω–µ —Å–º–æ–≥ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ \
–∞ —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–≥ \
—É—Ç–æ—á–Ω—é —á—Ç–æ –±–æ—Ç –∏ rabbitmq —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç \
–ø—Ä–æ–±–ª–µ–º–∞ —Å network



–∫–∞–∫ –ø—Ä–∏—Ç—è–Ω—É—Ç—å –∫ –∏–º–µ—é—â–∏–º—Å—è –¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —è –Ω–µ –¥–æ–≥–∞–¥–∞–ª—Å—è \
–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –¥–æ–≤–æ–ª—å–Ω–æ–≥–æ –ª–µ–≥–∫–æ \
–∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ submit –∏ –µ—Å–ª–∏ –Ω–∞–¥–æ –æ–∂–∏–¥–∞–µ–º —Å wait \
—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–º–æ—Ç—Ä–∏–º —Å result \
–∫–æ–ª-–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ \
@flow(task_runner=ThreadPoolTaskRunner(max_workers=3))